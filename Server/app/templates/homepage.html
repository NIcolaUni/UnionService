{% extends "paginaBase.html" %}

{% block content %}
<script>
    var socketImpegni = io.connect("{{sockUrl}}"+'/impegni');

    var registraCheck = function($this){

        var numero_impegno = $this.parent().parent().parent().parent().attr('class').split(' ')[1];


        socketImpegni.emit('checkaImpegno', {'dipendente': '{{dipendente.username}}', 'numero': numero_impegno});
    }

    var eliminaImpegno = function($this){

           var numero_impegno = $this.parent().parent().parent().attr('class').split(' ')[1];

           $this.parent().parent().parent().remove();

           socketImpegni.emit('eliminaImpegno', {'dipendente': '{{dipendente.username}}', 'numero': numero_impegno});
    }


</script>

<div id="page-wrapper">


  <div class="visible-xs visible-sm responsive-menu">
    <a href="#" class="toggle-menu">
        <i class="fa fa-bars"></i> Show Menu
    </a>
    <div class="show-menu">
      <ul class="main-menu">
        <li>
            <a class="show-1 active homebutton" href="#"><i class="fa fa-home"></i>Home</a>
        </li>
        <li>
            <a class="show-2 agendaButton" href="#"><i class="fa fa-book"></i>Agenda</a>
        </li>
        <li>
            <a class="show-3 calendarButton" href="#"><i class="fa fa-calendar"></i>Calendario</a>
        </li>
          {% if dipendente.dirigente%}
        <li>
            <a class="show-4 gestioneDipButton" href="#"><i class="fa fa-user-plus"></i>Gestione <br/> Dipendenti</a>
        </li>
          {% endif %}
          {% if dipendente.classe == 'commerciale' or  dipendente.dirigente %}
        <li>
            <a class="show-5 accoglienzaButton" href="#"><i class="fa fa-address-book-o"></i>Accogli <br/> Cliente</a>
        </li>
          {% endif %}

        <li>
            <a class="show-6 contactbutton" href="#"><i class="fa fa-envelope"></i>Invia un email</a>
        </li>
      </ul>
    </div>
  </div>


<!--==================================================================================================-->


  <header id="header" data-ng-include="'header'" data-ng-controller="headerCtrl as hctrl"></header>
  <aside id="sidebar" data-ng-include="'sidebarLeft'" data-ng-class="{ 'toggled': mactrl.sidebarToggle.left === true }"></aside>


  <section id="main">
    <section id="content">
      <div class="container" id="page-content">

        <div class="row" id="row-content">

          <div id="colonnaSx" class="col-md-2 hidden-sm">

            <nav id="nav" class="main-navigation hidden-xs hidden-sm">
              <ul class="main-menu">
                <li>
                    <a class="show-1 active homebutton" href="#"><i class="fa fa-home"></i>Home</a>
                </li>
                <li>
                    <a class="show-2 agendaButton" href="#"><i class="fa fa-book"></i>Agenda</a>
                </li>
                <li>
                    <a class="show-3 calendarButton" href="#"><i class="fa fa-calendar"></i>Calendario</a>
                </li>
                {% if dipendente.dirigente%}
                <li>
                    <a class="show-4 gestioneDipButton" href="#"><i class="fa fa-user-plus"></i>Gestione <br/> Dipendenti</a>
                </li>
                {% endif %}

                {% if dipendente.classe == 'commerciale' or  dipendente.dirigente  %}
                <li>
                    <a class="show-5 accoglienzaButton" href="#"><i class="fa fa-address-book-o"></i>Accogli <br/> Cliente</a>
                </li>
                {% endif %}

                <li>
                    <a class="show-6 contactbutton" href="#"><i class="fa fa-envelope"></i>Invia un email</a>
                </li>
              </ul>
            </nav>

          </div> <!-- fine colonnaSx -->


          <div class="col-md-8 col-sm-12 content-holder" id="colonnaCentrale">
            <div id="menu-container">

              <div id="menu-1" class="row homepage home-section text-center">
                <div class="welcome-text col-md-12 col-sm-12">

                  <h2>Welcome  <span class="red"> {{dipendente.nome}} {{dipendente.cognome}}</span></h2>
                  <p> <span class="orange">{{dipendente.classe}}
                  {%if dipendente.dirigente%} dirigente {% endif %}</span></p>

                    <div id="noteDipendenti"  class="row">


            <div class="row righe-homepage">
              <div class="col-md-3"></div>
              <div class="col-sm-12 col-md-6">
                {% raw %}
                  <!-- Todo Lists -->
                  <div id="todo-lists" data-ng-controller="todoCtrl as tctrl">
                    <div class="tl-header">

                        <small id="titleMemorandum">NOTE del GIORNO</small>

                    </div>

                    <div class="clearfix"></div>

                    <div class="tl-body">


                        <div id="add-tl-item" data-ng-class="{ 'toggled': tctrl.addTodoStat }" data-ng-click="tctrl.addTodoStat = true">
                            <i class="add-new-item zmdi zmdi-plus" data-ng-click="tctrl.addTodo($event)"></i>

                            <div class="add-tl-body">
                                <textarea id="textImpegno" placeholder="Testo..." data-ng-model="tctrl.todo"></textarea>

                                <div class="add-tl-actions">
                                {% endraw %}
                                    {% if dipendente.dirigente %}
                                    <select id="dipImpegni">
                                        <option>Personale</option>

                                        {% for collega in colleghi %}
                                        <option>{{collega.username}}</option>
                                        {% endfor %}
                                    </select>
                                    {% endif %}
                    {% raw %}
                                    <a class="zmdi zmdi-close" data-tl-action="dismiss" data-ng-click="tctrl.addTodoStat = false; $event.stopPropagation()"></a>
                                    <a id="addImpegno" class="zmdi zmdi-check" data-tl-action="save" data-ng-click="tctrl.addTodoStat = false; $event.stopPropagation()"></a>
                                </div>

                            </div>
                        </div>

                    {% endraw %}

                        <div id="contentImpegni" class="checkbox" >

                                {% for impegno in impegni %}

                                    <div class="rigaImpegni {{impegno.id}} {{impegno.checkato}}">

                                        <div class="media-body">

                                            <div class="pull-right">
                                               <a onclick="eliminaImpegno($(this));" class="delImpegno"  href="" > Ã— </a>
                                            </div>
                                            <div class="pull-center">

                                                  <label class="labelImpegno">
                                                     <input class="checkImpegno" onclick="registraCheck($(this));" type="checkbox">
                                                      <i class="input-helper"></i>
                                                    &emsp;
                                                    {% if impegno.dirigente == None %}

                                                        <span class="msgImpegno">{{ impegno.testo }}</span>
                                                    {% else %}
                                                        <span class="dirImpegni">{{impegno.dirigente}}:</span><br/><span class="msgImpegno conDirigente">{{ impegno.testo }}</span>

                                                    {% endif %}
                                                   </label>
                                            </div>

                                        </div>
                                    </div>

                                {% endfor %}

                        </div>

                    </div>
                  </div>

              </div>
              <div class="col-md-3"></div>
            </div>


                    </div>

                </div> <!-- fine welcome-text -->

              </div> <!-- fine homepage -->

    <!--============================ Sezioni "chiamate" via Ajax =====================================-->

              <div id="menu-2" class="row content calendario-section col-md-6 col-sm-12">
                  <div id='calendar-agenda' data-full-calendar class="agenda"></div>

              </div>

             <div id="menu-3" class="content col-md-6 col-sm-12">
                <div id='calendar-calendario'></div>
             </div>

              <div id="menu-4" class="content gestioneDip-section col-sm-12">

              </div>

              <div id="menu-5" class="content accoglienza-section col-sm-12">

              </div>

              <div id="menu-6" class="content profiloDip-section col-sm-12">

              </div>


    <!--==============================================================================================-->

            </div> <!-- fine menu-container -->
          </div> <!-- fine colonnaCentrale -->




        </div> <!-- fine row-content -->
      </div> <!-- fine page content -->

    </section>
  </section>

<!--===================================================================================================-->

</div> <!-- fine page-wrapper -->

<script>

  var socketCalendario = io.connect("{{sockUrl}}"+'/calendario');
  var socketAgenda = io.connect("{{sockUrl}}"+'/agenda');

  //usato per inviarsi messaggi asincroni localmente
  var socketLocal = io.connect("{{sockUrl}}"+'/local');

  socketAgenda.on('responso_imposta_appuntamento', function(msg){

    var titolo="";
    var messaggio="";


    if( msg['risposta'] ){
        titolo='Appuntamento impostato correttamente';

          var start_moment =  $.fullCalendar.moment(msg['giorno']+'T'+msg['inizioH']);
          var end_moment = $.fullCalendar.moment(msg['giorno']+'T'+msg['fineH']);


          $('.agenda').fullCalendar( 'addEventSource', {


              events: [
                {
                  title  : msg['titolo'],
                  start  : start_moment,
                  end : end_moment
                }
              ]}
          );
    }
    else{
        titolo="L'appuntamento non e' stato impostato";
        messaggio="verificare di non avere appuntamenti che si accavallano o con ad una distanza inferiore ai 15min";

    }

    swal({
        title: titolo,
        text: messaggio,
        showCancelButton: true,
        confirmButtonColor: '#DD6B55',
        confirmButtonText: 'Ok',
        cancelButtonText: 'annulla',
        closeOnConfirm: true,

    });


  });



  var swalFormNewImpegno = function(date, titolo, dalle, alle){

        var dictFormTitolo = { id: 'titolo', label: 'Titolo appuntamento/impegno:', name: 'titolo',  placeholder: 'titolo...' };

        if( titolo != "" )
             dictFormTitolo = { id: 'titolo', label: 'Titolo appuntamento/impegno:', name: 'titolo',  placeholder: 'titolo...', value: titolo };


        swal.withFormAsync({
            title: 'Nuovo appuntamento/impegno',
            showCancelButton: true,
            confirmButtonColor: '#DD6B55',
            confirmButtonText: 'Ok',
            cancelButtonText: 'annulla',
            closeOnConfirm: false,
            formFields: [

                dictFormTitolo,

                { id: 'dalle',  type: 'time', label: 'Dalle:', name: 'dalle', value: dalle},

                { id: 'alle',  type: 'time', label: 'Alle:', name: 'alle', value: alle},

            ]
        }).then(function (context) {
            if(context._isConfirm){
                 var start_moment =  $.fullCalendar.moment(date.format()+'T'+context.swalForm['dalle']);
                 var end_moment = $.fullCalendar.moment(date.format()+'T'+context.swalForm['alle']);

                if( context.swalForm['titolo'] == "" ){
                    alert("Impostare un titolo per l'appuntamento")

                    swalFormNewImpegno( date, '', context.swalForm['dalle'], context.swalForm['alle'] );

                }
                else if( end_moment.isBefore(start_moment) ){
                    alert('Il periodo orario impostato non ha senso '+ context.swalForm['dalle'] + ' ' + context.swalForm['alle']);

                    swalFormNewImpegno( date, context.swalForm['titolo'], context.swalForm['dalle'], context.swalForm['alle'] );


                }
                else
                    socketAgenda.emit('imposta appuntamento', {
                        'dip': '{{dipendente.username}}',
                        'giorno': date.format(),
                        'inizio_ora': context.swalForm['dalle'],
                        'fine_ora': context.swalForm['alle'],
                        'titolo': context.swalForm['titolo']
                    });





            }

        });

  }

  $('.agenda').fullCalendar({
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'month,agendaWeek,agendaDay,listWeek'
      },
      navLinks: true, // can click day/week names to navigate views
      editable: true,
      eventDurationEditable: true,
      eventLimit: true, // allow "more" link when too many events
      views: {
          agenda: {
            eventLimit: 3 // adjust to 6 only for agendaWeek/agendaDay
          }
      },
      events: [
        {% for evento in agenda %}
        {
          title: '{{evento.titolo}}\n{{evento.luogo}}',
          start: '{{evento.start_date}}',
          color: 'blue'
        },
        {% endfor %}
       ],


      eventClick: function(calEvent, jsEvent, view) {

           jsEvent.preventDefault();
           jsEvent.stopPropagation();

         /*  var inizioEvento =
           var fineEvento =*/

           $('body').append(
                '<div id="popupEvent-click" style="display:none"> \
                    <div> \
                        <div class="panel panel-default"> \
                            <div class="panel-heading subtitle agendaSubtitle">Durata evento: <button class="eliminaAppuntamento">Elimina</button></div> \
                            <div class="panel-body form-inline dept1"> \
                              <label>Orario inizio:</label>'+
                               '<input class="modificaOrarioInizioAgenda" type="time" value="'+ calEvent.start.format().split('T')[1].split('+')[0] + '">'+
                             '<br/> <label>Orario fine:</label>'+
                               '<input class="modificaOrarioFineAgenda"  type="time" value="'+ calEvent.end.format().split('T')[1].split('+')[0] + '">'+
                            '</div> \
                        </div> \
                    </div> \
                </div>'
           );


           var popupEvent = function() {


                 $('.modificaOrarioInizioAgenda').change(function(){
                        var new_start=$(this).val();
                        var old_end=calEvent.end;
                        var old_start=calEvent.start;

                        new_start=$.fullCalendar.moment(calEvent.start.format().split('T')[0]+'T'+new_start);

                        if( new_start.isAfter(old_end.format()) ){
                            alert('Il periodo orario impostato non ha senso');
                            $(this).val( old_start.format().split('T')[1].split('+')[0] );
                        }
                        else{

                            socketAgenda.emit('cambia_orario_inizio',{
                                'dip': '{{dipendente.username}}',
                                'giorno': calEvent.start.format().split('T')[0],
                                'old_inizio': calEvent.start.format().split('T')[1].split('+')[0],
                                'new_inizio' : $(this).val()
                            });



                        }
                 });

                 $('.modificaOrarioFineAgenda').change(function(msg){


                        socketAgenda.emit('cambia_orario_fine', {
                            'dip': '{{dipendente.username}}',
                            'giorno': calEvent.end.format().split('T')[0],
                            'old_fine': calEvent.end.format().split('T')[1].split('+')[0],
                            'new_inizio': $('.modificaOrarioFineAgenda').val()
                        });

                 });

                 $('.eliminaAppuntamento').click(function(){
                        socketAgenda.emit( 'elimina_appuntamento', {
                            'dip': '{{dipendente.username}}',
                            'giorno': calEvent.start.format().split('T')[0],
                            'inizio_ora': calEvent.start.format().split('T')[1].split('+')[0]

                        });

                        $('.agenda').fullCalendar( 'removeEvents', function(eventObj){

                            if(eventObj.start.format().split('T')[0] == calEvent.start.format().split('T')[0])
                                if( eventObj.start.format().split('T')[1].split('+')[0] == calEvent.start.format().split('T')[1].split('+')[0] )

                                    return true
                            return false;
                        } );

                 });



                 socketAgenda.on('responso_elimina_appuntamento', function(msg){


                         swal({
                            title: 'Eliminazione effettuata',
                            showCancelButton: true,
                            confirmButtonColor: '#DD6B55',
                            confirmButtonText: 'Ok',
                            cancelButtonText: 'annulla',
                            closeOnConfirm: true,

                         });


                 });

                 socketAgenda.on('responso_modifica_inizioOra', function(msg){



                        if( !msg['risposta'] ){

                            titolo="L'appuntamento non e' stato modificato";
                            messaggio="verificare di non avere appuntamenti che si accavallano o con ad una distanza inferiore ai 15min";

                            swal({
                                title: titolo,
                                text: messaggio,
                                showCancelButton: true,
                                confirmButtonColor: '#DD6B55',
                                confirmButtonText: 'Ok',
                                cancelButtonText: 'annulla',
                                closeOnConfirm: true,

                            });
                        }
                        else{

                           calEvent.start=$.fullCalendar.moment(calEvent.start.format().split('T')[0]+'T'+msg['new_start']);
                           $('.agenda').fullCalendar( 'updateEvent', calEvent );


                        }
                 });



           }

            $(this).hunterPopup({

                width: '320px',
                height: '200px',
                title: calEvent.title,
                content: $('#popupEvent-click'),
                event: popupEvent

            });

            $(this).trigger('launch-popup-click');


      },
      dayClick: function(date, jsEvent, view) {


           swalFormNewImpegno(date, '', '07:00', '07:30');


      }
  });

  {% for appuntamento in agenda %}

      var start_moment =  $.fullCalendar.moment('{{appuntamento.giorno}}T{{appuntamento.inizio_ora}}');
      var end_moment = $.fullCalendar.moment('{{appuntamento.giorno}}T{{appuntamento.fine_ora}}');

      $('.agenda').fullCalendar( 'addEventSource', {


          events: [
            {
              title  : '{{appuntamento.titolo}}',
              start  : start_moment,
              end : end_moment
            }
          ]}
      );

  {% endfor %}

/*Se il mouse non e' sopra il popup lo elimina automaticamente dopo 300 ms*/

  $('.fc-view-container').mouseout(function(){

    setTimeout(function(){
        if (!$('.Hunter-pop-up:hover').length != 0) {
            $('.Hunter-pop-up').remove();
            $('#popupEvent-click').remove()
        }
    }, 300);


  });

  $('.fc-view-container').mouseover(function(){

    setTimeout(function(){
        if (!$('.Hunter-pop-up:hover').length != 0) {
            $('.Hunter-pop-up').remove();
            $('#popupEvent-click').remove()
        }
    }, 300);


  });

/******************************************************************/


 /* Collego i bottoni alle pagine che devono ritornare */

    var chiamatoCalendario = false;
    var chiamataAgenda = false;

	$(".main-menu a").click(function(){
		var id =  $(this).attr('class');
		id = id.split('-');
        idNum=id[1].split(' ')[0];

		// se sto scegliendo l'opzione calendario o agenda, mi ritrovo a dover usare
		// delle librerie che necessitano della creazione di un div con id "calendar".
		// Poiche' ho due sezioni con due elementi con stesso id, differenzo gli id che
		// dovrebbero essere uguali e quando la relativa sezione verra' chiamato gli
		// assegno l'id "corretto"

		if( idNum == '3' ){
		    chiamatoCalendario = true;

		    if( chiamataAgenda ){
		        chiamataAgenda = false;
		        $('#calendar').attr('id', 'calendar-agenda');
		    }

		    $('#calendar-calendario').attr('id', 'calendar');

            function saveEvent(e, titolo, descrizione) {

                var dataSource = $('#calendar').data('calendar').getDataSource();

                newId=0;

                for( var i in dataSource ){
                    if( dataSource[i].id > newId )
                        newId=dataSource[i].id
                }

                newId++

                dataSource.push({id: newId, startDate: e.startDate, endDate: e.endDate, name: titolo, dipendente: '{{dipendente.username}}', descrizione: descrizione })
                $('#calendar').data('calendar').setDataSource(dataSource);

                 socketCalendario.emit('imposta_evento_calendario', {
                    'dip': '{{dipendente.username}}',
                    'titolo': titolo,
                    'descrizione': descrizione,
                    'start_date': moment(e.startDate).add(1, 'd').toDate(),
                    'end_date': moment(e.endDate).add(1, 'd').toDate()
                });

            }

            function editEvent(event) {
              $('#event-modal input[name="event-index"]').val(event ? event.id : '');
              $('#event-modal input[name="event-name"]').val(event ? event.name : '');
              $('#event-modal input[name="event-location"]').val(event ? event.location : '');
              $('#event-modal input[name="event-start-date"]').datepicker('update', event ? event.startDate : '');
              $('#event-modal input[name="event-end-date"]').datepicker('update', event ? event.endDate : '');
              $('#event-modal').modal();
            }

            //elimina l'evento dal calendario nella sessione corrente senza dover refreshare la pagina
            function deleteEvent(dipendente, titolo, startDate) {
              var dataSource = $('#calendar').data('calendar').getDataSource();

              for(var i in dataSource) {
                  if(dataSource[i].dipendente == dipendente && dataSource[i].name == titolo && dataSource[i].startDate == startDate) {

                      dataSource.splice(i, 1);
                      break;
                  }
              }

              $('#calendar').data('calendar').setDataSource(dataSource);
            }

            var eventToDel=''

            function eliminaEventoCalendario(idEvent){

                 var dataSource = $('#calendar').data('calendar').getDataSource();


                  for(var i in dataSource) {

                      if(dataSource[i].id == idEvent) {

                          startDateMonth=dataSource[i].startDate.getMonth()+1
                          startDate = dataSource[i].startDate.getDate()+'/'+startDateMonth+'/'+dataSource[i].startDate.getFullYear()

                        //  alert( startDate )

                          socketCalendario.emit('elimina_evento_calendario', {
                                'dip': '{{dipendente.username}}',
                                'titolo': dataSource[i].name,
                                'dipendente_generatore': dataSource[i].dipendente,
                                'start_date': startDate//dataSource[i].startDate
                          });


                          eventToDel={'dipendente': dataSource[i].dipendente, 'titolo': dataSource[i].name, 'start_date': dataSource[i].startDate }

                          break;
                      }
                  }


            }

            socketCalendario.on( 'conferma_registrazione_evento', function(){

                    alert('Registrazione evento avvenuta con successo');

            });

            socketCalendario.on( 'conferma_eliminazione_evento', function(){

                    swal({
                        title: 'Eliminazione effettuata',
                        showCancelButton: true,
                        confirmButtonColor: '#DD6B55',
                        confirmButtonText: 'Ok',
                        cancelButtonText: 'annulla',
                        closeOnConfirm: true,

                    });

                    deleteEvent(eventToDel['dipendente'], eventToDel['titolo'],  eventToDel['start_date'])
                    $('.Hunter-pop-up').remove();

            });


            var currentYear = new Date().getFullYear();

            $('#calendar').calendar(

              {
                 enableContextMenu: true,
                 enableRangeSelection: true,
                 language: 'it',
                 dataSource: [

                   {% for evento in calendario %}
                    {% if evento.tipologia %}
                       {
                           id: '{{evento.id_evento}}',
                           name: '{{evento.titolo}}',
                           location: '{{evento.luogo}}',
                           startDate: moment('{{evento.start_date}}').toDate(),
                           endDate: moment('{{evento.end_date}}').toDate(),
                           descrizione: '{{evento.descrizione}}',
                           dipendente: '{{evento.dipendente}}'
                       },
                    {% endif %}
                   {% endfor %}

                 ],

                 mouseOnDay: function(e) {


                     if(e.events.length > 0) {

                         $('#popupEvent-year-cal').remove();

                         var content = '';

                         for(var i in e.events) {

                            {% if dipendente.dirigente %}
                                 content += '<div class="panel-heading subtitle">'+ e.events[i].name +
                                                '<div class="popup-ctrl-btns '+ e.events[i].id+'"><button class="eliminaEvento">Elimina</button></div> \
                                             </div> \
                                             <div class="panel-body form-inline dept1">'+
                                              e.events[i].descrizione +
                                             '</div>';
                            {% else %}

                                content += '<div class="panel-heading subtitle">'+ e.events[i].name +' </div> \
                                             <div class="panel-body form-inline dept1">'+
                                              e.events[i].descrizione +
                                             '</div>';

                            {% endif %}
                         }



                         $('body').append(
                            '<div id="popupEvent-year-cal" style="display:none"> \
                                <div> \
                                    <div class="panel panel-default">'+
                                     content +
                                    '</div> \
                                </div> \
                            </div>'
                         );

                         var popupEvent = function() {

                            $('.eliminaEvento').unbind().click(function(event){
                                var idEvento=$(this).parent().attr('class').split(' ')[1];
                                eliminaEventoCalendario(idEvento);
                            });
                         }


                         $(e.element).hunterPopup({

                            width: '320px',
                            height: '200px',
                            title: "Eventi del giorno",
                            content: $('#popupEvent-year-cal'),
                            event: popupEvent

                         });

                         $(e.element).trigger('launch-popup-overYear');


                     }


                 },
                 mouseOutDay: function(e) {


                 },
                 selectRange: function(e){

                    monthStartDate=e.startDate.getMonth()+1;
                    monthEndDate=e.endDate.getMonth()+1;
                    var startDate = e.startDate.getDate()+"/"+ monthStartDate+"/"+e.startDate.getFullYear();
                    var endDate = e.endDate.getDate()+"/"+ monthEndDate+"/"+e.endDate.getFullYear();


                    {% if dipendente.dirigente %}
                        swal.withFormAsync({
                            title: 'Impostazione evento dal '+  startDate + ' al ' + endDate,
                            showCancelButton: true,
                            confirmButtonColor: '#DD6B55',
                            confirmButtonText: 'Ok',
                            cancelButtonText: 'annulla',
                            closeOnConfirm: true,
                            formFields: [

                                { id: 'titolo', label: 'Titolo evento:', name: 'titolo', placeholder: 'titolo...' },
                                { id: 'descrizione', label: "Descrizione dell'evento:", name: 'descrizione', placeholder: 'descrizione...' },


                            ]
                        }).then(function (context) {
                            if(context._isConfirm){


                                saveEvent(e, context.swalForm['titolo'], context.swalForm['descrizione'] );

                            }

                        });

                    {% endif %}

                 }

              }
            )



		}
		else if( idNum == '2'){
		    chiamataAgenda =true;

		    if( chiamatoCalendario ){
		        chiamatoCalendario = false;
		        $('#calendar').attr('id', 'calendar-calendario');
		    }

		    $('#calendar-agenda').attr('id', 'calendar');

		}

        $('.calendar').mouseleave(function(){

            if( $('.day:hover').attr('style') === undefined ){
                setTimeout(function(){

                    if (!$('.Hunter-pop-up:hover').length != 0 ) {

                        $('.Hunter-pop-up').remove();
                    }
                }, 300);

            }

        });



		$('a.active').removeClass('active');
	  	$(this).addClass('active');
		$("#menu-container .content").slideUp('slow');
		$("#menu-container .homepage").slideUp('slow');

		$("#menu-container #menu-"+id[1]).slideDown('slow');
        console.log('SOno dwsds '+ $('#menu-3').attr('class'))
        if( idNum != '3'){
            $('#menu-3').removeClass('force-show');
		    $('#menu-3').addClass( 'force-hide' );

		}else{
		    $('#menu-3').removeClass('force-hide');
		    $('#menu-3').addClass( 'force-show' );

        }
         console.log('SOno dwsds '+ $('#menu-3').attr('class'))

		return false;
	});


	$(".main-menu a.homebutton").click(function(){
		//	$("#menu-container .content").slideUp('slow');
			$("#menu-container .homepage").slideDown('slow');

			return false;
	});
/*
	$(".main-menu a.registraDipButton").click(function(){
			$(".registraDip-section").load("static/templates/registraDip.html #container-contact100");
			//$("#menu-container .content").slideUp('slow');
			$("#menu-container .registraDip-section").slideDown('slow');



			$.getScript("static/form/js/main.js");
			return false;
	});
*/
	$(".main-menu a.agendaButton").click(function(){
		//	$("#menu-container .content").slideUp('slow');
			$("#menu-container .calendario-section").slideDown('slow');
			$("#calendar").fullCalendar("render");
			return false;
	});


	 $(".main-menu a.profiloDipButton").click(function(){
			$(".profiloDip-section").load("{{url_for('paginaProfilo')}} #container-profiloDip");
    	    $("#menu-container .profiloDip-section").slideDown('slow');

			return false;
	 });

	 $(".main-menu a.gestioneDipButton").click(function(){
			$(".gestioneDip-section").load("{{url_for('gestioneDip')}}");
		//	$("#menu-container .content").slideUp('slow');
	    	$("#menu-container .gestioneDip-section").slideDown('slow');

			return false;
	 });

	$(".main-menu a.accoglienzaButton").click(function(){
			$(".accoglienza-section").load("{{url_for('accoglienza', error=0)}}");
			//$("#menu-container .content").slideUp('slow');
			$("#menu-container .accoglienza-section").slideDown('slow');



			$.getScript("static/form/js/main.js");
			return false;
	});


</script>

<script type="text/javascript" charset="utf-8">


    var socketHome = io.connect("{{sockUrl}}"+'/home');

    socketHome.on('connect', function() {
        console.log('connected');


        socketHome.emit('registra_sid',   {'username': '{{dipendente.username}}'} );
    });


</script>

<script>


    $(".rigaImpegni").each(function(){
    /*Dopo che il memorandum degli impegni e' stato creato a livello di DOM, triggero un evento Click
      per ogni impegno che e' statp registrato nel DB con un valore di 'check' pari a True */


        var check = $(this).attr('class').split(' ')[2];

        if( check == 'True' )
            $(this).children('.media-body').children('.pull-center').children('.labelImpegno').children('.checkImpegno').trigger('click');


    });



    socketImpegni.on('aggiungiImpegno', function(msg){

        if( msg['tipologia'] == "Personale" )
        {

            $('#contentImpegni').append(

                '<div class="rigaImpegni '+msg['numero']+'"> \
                    <div class="media-body"> \
                        <div class="pull-right"> \
                            <a onclick="eliminaImpegno($(this));" class="delImpegno"  href="" > Ã— </a> \
                        </div> \
                        <div class="pull-center"> \
                            <label class="labelImpegno"> \
                                <input onclick="registraCheck($(this));" class="checkImpegno" type="checkbox"> \
                                <i class="input-helper"></i> \
                                &emsp; \
                                <span class="msgImpegno">'+msg['testo']+'</span> \
                            </label> \
                        </div> \
                    </div> \
                </div>'

            );

        }
        else{

            $('#contentImpegni').append(

                '<div class="rigaImpegni '+msg['numero']+'"> \
                    <div class="media-body"> \
                        <div class="pull-right"> \
                            <a onclick="eliminaImpegno($(this));" class="delImpegno"  href="" > Ã— </a> \
                        </div> \
                        <div class="pull-center"> \
                            <label class="labelImpegno"> \
                                <input onclick="registraCheck($(this));" class="checkImpegno" type="checkbox"> \
                                <i class="input-helper"></i> \
                                &emsp; \
                                <span class="dirImpegni">'+msg['tipologia']+':</span><br/><span class="msgImpegno conDirigente">'+msg['testo']+'</span>  \
                            </label> \
                        </div> \
                    </div> \
                </div>'

            );
        }

    });


    {% if dipendente.dirigente %}
        $('#addImpegno').click(function(){


            newImpegno = $('#textImpegno').val();
            selectImpegno = $('#dipImpegni').val();

            // se non viene inserito nulla nel campo di testo
            if( newImpegno == "" )
                return;

            if( selectImpegno == "Personale" )
            {
                socketImpegni.emit('registraImpegno', {'testo': newImpegno, 'dip': '{{dipendente.username}}', 'dir': "" });
            }
            else
                socketImpegni.emit('registraImpegno', {'testo': newImpegno, 'dip': selectImpegno, 'dir': '{{dipendente.username}}'});




        });

        socketImpegni.on('conferma_impegno_inviato', function(msg){
            var titolo = "L'impegno Ã¨ stato inviato correttamente";

            swal({
                title: titolo,
                showCancelButton: true,
                confirmButtonColor: '#DD6B55',
                confirmButtonText: 'Ok',
                cancelButtonText: 'annulla',
                closeOnConfirm: true,

            });

        });


    {% else %}

        $('#addImpegno').click(function(){


            newImpegno = $('#textImpegno').val();

            // se non viene inserito nulla nel campo di testo
            if( newImpegno == "" )

            socketImpegni.emit('registraImpegno', {'testo': newImpegno, 'dip': '{{dipendente.username}}', 'dir': "" });

        });



    {% endif %}



  /*  $('a.delImpegno').click(function(){
        var numero_impegno = $(this).parent().parent().attr('class').split(' ')[1];

        $(this).parent().parent().remove();

        socketImpegni.emit('eliminaImpegno', {'dipendente': '{{dipendente.username}}', 'numero': numero_impegno});

    });*/


</script>

<script>
    /* In questa parte faccio lo styling dell'agenda */

     $('.fc-clear').remove();

     $('.fc-header-toolbar').append(
        '<div id="agendaHeaderParteSopra"></div> \
         <div id="agendaHeaderParteSotto"></div>'
     );

    $('.fc-right').detach().appendTo('#agendaHeaderParteSopra');
    $('.fc-center').detach().appendTo('#agendaHeaderParteSotto');
    $('.fc-left').detach().appendTo('#agendaHeaderParteSotto');

    $('.fc-left').children('.fc-button-group').addClass('cambioGiorno');

</script>

{% endblock %}