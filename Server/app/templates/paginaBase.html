<!DOCTYPE html>
<html lang="it" data-ng-app="materialAdmin" data-ng-controller="materialadminCtrl as mactrl">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Gestionale Aziendale UnionService</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">


<!--==================================================================================================-->
    <!-- Vendor CSS -->
    <link href="{{url_for('static', filename='headerAndForm/vendors/bower_components/animate.css/animate.min.css') }}" rel="stylesheet">
    <link href="{{url_for('static', filename='headerAndForm/vendors/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.min.css') }}" rel="stylesheet">
    <link href="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-loading-bar/src/loading-bar.css') }}" rel="stylesheet">


    <!-- CSS -->
    <link href="{{url_for('static', filename='headerAndForm/css/app.css') }}" rel="stylesheet">
    <link href="{{url_for('static', filename='headerAndForm/css/demo.css') }}" rel="stylesheet">


<!--=================================================================================================-->

    <link href="{{url_for('static', filename='bootstrap/css/normalize.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="{{url_for('static', filename='css/font-awesome.css') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/font-awesome.min.css') }}">
    <link href="{{url_for('static', filename='bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">

<!--==================== css form registrazione e profilo =============================================-->

    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/fonts/iconic/css/material-design-iconic-font.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/vendor/animate/animate.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/vendor/css-hamburgers/hamburgers.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/vendor/animsition/css/animsition.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/vendor/select2/select2.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/vendor/daterangepicker/daterangepicker.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/vendor/noui/nouislider.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/css/util.css') }}">

    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/css/main.css') }}">
<!--===============================================================================================-->


    <link rel="stylesheet" href="{{url_for('static', filename='css/profiloDip.css') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/button-modificaProfilo.css') }}">

<!--==================== css calendario e agenda====== =============================================-->
    <link href="{{url_for('static', filename='agenda/fullcalendar.min.css') }}" rel='stylesheet' />
    <link href="{{url_for('static', filename='agenda/fullcalendar.print.min.css') }}" rel='stylesheet' media='print' />

    <script src="{{url_for('static', filename='js/vendor/jquery-1.10.2.min.js') }}"></script>

    <script src="{{url_for('static', filename='agenda/lib/moment.min.js') }}"></script>
    <script src="{{url_for('static', filename='agenda/fullcalendar.min.js') }}"></script>
    <script src="{{url_for('static', filename='agenda/locale/it.js') }}"></script>
<!--===============================================================================================-->

    {% if not prezzario and not schedaFornitoriCss and not prezzarioProdottiCss %}
    <link href="{{url_for('static', filename='headerAndForm/vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.css') }}" rel='stylesheet' />
    <script src="{{url_for('static', filename='js/vendor/sweet-alert2.min.js') }}"></script>
    {% endif %}
<!--===============================favicons =========================================================-->


    <link rel="apple-touch-icon" sizes="57x57" href="{{url_for('static', filename='favicon/apple-icon-57x57.png') }}">
    <link rel="apple-touch-icon" sizes="60x60" href="{{url_for('static', filename='favicon/apple-icon-60x60.png') }}">
    <link rel="apple-touch-icon" sizes="72x72" href="{{url_for('static', filename='favicon/apple-icon-72x72.png') }}">
    <link rel="apple-touch-icon" sizes="76x76" href="{{url_for('static', filename='favicon/apple-icon-76x76.png') }}">
    <link rel="apple-touch-icon" sizes="114x114" href="{{url_for('static', filename='favicon/apple-icon-114x114.png') }}">
    <link rel="apple-touch-icon" sizes="120x120" href="{{url_for('static', filename='favicon/apple-icon-120x120.png') }}">
    <link rel="apple-touch-icon" sizes="144x144" href="{{url_for('static', filename='favicon/apple-icon-144x144.png') }}">
    <link rel="apple-touch-icon" sizes="152x152" href="{{url_for('static', filename='favicon/apple-icon-152x152.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{url_for('static', filename='favicon/apple-icon-180x180.png') }}">
    <link rel="icon" type="image/png" sizes="192x192"  href="{{url_for('static', filename='favicon/android-icon-192x192.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{url_for('static', filename='favicon/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="96x96" href="{{url_for('static', filename='favicon/favicon-96x96.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{url_for('static', filename='favicon/favicon-16x16.png') }}">
    <link rel="manifest" href="{{url_for('static', filename='favicon/manifest.json') }}">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="{{url_for('static', filename='favicon/ms-icon-144x144.png') }}">
    <meta name="theme-color" content="#ffffff">

<!--===================================socket io====================================================-->
    <script src="{{url_for('static', filename='js/vendor/socket.io.js') }}"></script>
    <!--===========================================================================================================-->

        <!-- Angular -->
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular/angular.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-animate/angular-animate.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-resource/angular-resource.min.js') }}"></script>

        <!-- Angular Modules -->
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-ui-router/release/angular-ui-router.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-loading-bar/src/loading-bar.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/oclazyload/dist/ocLazyLoad.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-bootstrap/ui-bootstrap-tpls.min.js') }}"></script>

        <!-- Common Vendors -->
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/jquery.nicescroll/jquery.nicescroll.min.js') }}"></script>

        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/Waves/dist/waves.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bootstrap-growl/bootstrap-growl.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/ng-table/dist/ng-table.min.js') }}"></script>



        <!-- Using below vendors in order to avoid misloading on resolve -->
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/flot/jquery.flot.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/flot.curvedlines/curvedLines.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/flot/jquery.flot.resize.js') }}"></script>
       <!--  <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/moment/min/moment.min.js') }}"></script>
       <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/fullcalendar/dist/fullcalendar.min.js') }}"></script>-->
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/flot-orderBars/js/jquery.flot.orderBars.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/flot/jquery.flot.pie.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/flot.tooltip/js/jquery.flot.tooltip.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-nouislider/src/nouislider.min.js') }}"></script>

        <!-- App level -->
        <script src="{{url_for('static', filename='headerAndForm/js/app.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/config.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/controllers/main.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/services.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/templates.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/controllers/ui-bootstrap.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/controllers/table.js') }}"></script>


        <!-- Template Modules -->
        <script src="{{url_for('static', filename='headerAndForm/js/modules/template.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/ui.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/charts/flot.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/charts/other-charts.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/form.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/media.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/components.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/calendar.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/demo.js') }}"></script>

<!--===========================================================================================================-->

    <link rel="stylesheet" href="{{url_for('static', filename='css/agenda.css') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/gestioneDip.css') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/popover.css') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/registraDipendente.css') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/impegni.css') }}">



    <link rel="stylesheet" href="{{url_for('static', filename='swal-forms/swal-forms.css') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='swal-forms/sweet-alert.css') }}">
    <script src="{{url_for('static', filename='swal-forms/sweet-alert.js') }}"></script>
    <script src="{{url_for('static', filename='swal-forms/swal-forms.js') }}"></script>

    <link rel="stylesheet" href="{{url_for('static', filename='calendario/css/bootstrap-year-calendar.css') }}">
    <script src="{{url_for('static', filename='calendario/js/bootstrap-year-calendar.js') }}"></script>

    <link rel="stylesheet" href="{{url_for('static', filename='chat/css/chat.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='chat/css/bubble.css')}}">

    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='hunterPopup/css/hunterPopup.css')}}">
    <script type="text/javascript" src="{{url_for('static', filename='hunterPopup/js/jquery-popup.js')}}"></script>

    {% if scheda %}
        <link rel="stylesheet" href="{{url_for('static', filename='prezzariEschede/css/schedeArtForPro.css')}}">
        <link href="{{url_for('static', filename='usPopup/usPopup.css')}}" media="all" rel="stylesheet" type="text/css">
        <script src="{{url_for('static', filename='usPopup/usPopup.js')}}"></script>
    {% endif %}
    {% if scheda_artigiani %}
        <link rel="stylesheet" href="{{url_for('static', filename='prezzariEschede/css/schedaArtigiani.css')}}">
        <script src="{{url_for('static', filename='prezzariEschede/js/schedaArtigiani.js')}}"></script>
    {% endif %}
    {% if scheda_fornitori %}
        <link rel="stylesheet" href="{{url_for('static', filename='prezzariEschede/css/schedaFornitori.css')}}">
        <script src="{{url_for('static', filename='prezzariEschede/js/schedaFornitori.js')}}"></script>
    {% endif %}
    {% if prezzario_prodotti %}
        <link rel="stylesheet" href="{{url_for('static', filename='prezzariEschede/css/prezzarioProdotti.css')}}">
        <script src="{{url_for('static', filename='prezzariEschede/js/prezzarioProdotti.js')}}"></script>
    {% endif %}
    {% if prezzario_edile %}
        <link rel="stylesheet" href="{{url_for('static', filename='prezzariEschede/css/prezzarioEdile.css')}}">
        <script src="{{url_for('static', filename='prezzariEschede/js/prezzarioEdile.js')}}"></script>
    {% endif %}
    {% if scheda %}
        <script src="{{url_for('static', filename='prezzariEschede/js/main.js')}}"></script>
    {% endif %}

</head>

    {% if fittizio %}
        <body>
    {% else %}
        <body data-ng-class="{ 'sw-toggled': mactrl.layoutType === '1', 'modal-open': mactrl.sidebarToggle.left === true }">
    {% endif %}

        <div class="site-bg"></div>
        <div class="site-bg-overlay"></div>

       {% block content %}
       {% endblock %}

        <div class="chat-div row">
            <label id="chat-title">Chat</label>
            <div id="openCloseChat" class="col-md-3"><a class="close-chat fa fa-arrow-left"></a></div>
            <div class="listColleghi col-md-9">
                <ul id="ulListColleghi">
                    {% for collega in colleghi %}
                    <li class="collega"><label class="{{collega.username}}"><span class="chatImgProfile"><img src="{{url_for('static', filename='immaginiProfilo/'+collega.immagine_profilo ) }}"></span><span class="chatNameProfile">{{collega.nome}} {{collega.cognome}}</span></label></li>
                    {% endfor %}
                </ul>
            </div>

        </div>

<!--================================= JS Form =================================================================-->
       <script src="{{url_for('static', filename='form/vendor/animsition/js/animsition.min.js') }}"></script>
       <script src="{{url_for('static', filename='form/vendor/bootstrap/js/popper.js') }}"></script>
       <script src="{{url_for('static', filename='bootstrap/js/bootstrap.min.js') }}"></script>
       <script src="{{url_for('static', filename='form/vendor/select2/select2.min.js') }}"></script>
<!--===========================================================================================================-->



        <script src="{{url_for('static', filename='js/main.js') }}"></script>
        <script src="{{url_for('static', filename='chat/js/chat.js') }}"></script>

        <script>

            var socketChat = io.connect("{{sockUrl}}"+'/chat');

            $('.collega label').click(function(){

                 var collegaUsername = $(this).attr('class');

                 $('.close-chat').trigger('click');
                 $('.open-chat').trigger('click');
                 $('#chat-box').remove();

                 nomeCollega = $(this).children('span').text();

                 $(' <div id="chat-box" class="'+collegaUsername+'"> \
                       <div id="chat-box-header"><label>'+nomeCollega+'</label><span id="controlChatBox"><a class="closeChatBox fa fa-close"></a></span></div> \
                       <div class="speech-wrapper"> \
                        <div class="bubble"> \
                            <div class="txt"> \
                                <p class="name">Benni</p> \
                                <p class="message">Hey, check out this Pure CSS speech bubble...</p> \
                                <span class="timestamp">10:20 pm</span> \
                            </div> \
                            <div class="bubble-arrow"></div>\
                        </div> \
                        <div class="bubble alt"> \
                            <div class="txt"> \
                                <p class="name alt">Benni</p> \
                                <p class="message">Hey, check out this Pure CSS speech bubble...</p> \
                                <span class="timestamp">10:20 pm</span> \
                            </div> \
                            <div class="bubble-arrow alt"></div>\
                        </div> \
                        <div class="bubble"> \
                            <div class="txt"> \
                                <p class="name">Benni</p> \
                                <p class="message">Hey, check out this Pure CSS speech bubble...</p> \
                                <span class="timestamp">10:20 pm</span> \
                            </div> \
                            <div class="bubble-arrow"></div>\
                        </div> \
                        <div class="bubble alt"> \
                            <div class="txt"> \
                                <p class="name alt">Benni</p> \
                                <p class="message">Hey, check out this Pure CSS speech bubble...</p> \
                                <span class="timestamp">10:20 pm</span> \
                            </div> \
                            <div class="bubble-arrow alt"></div>\
                        </div> \
                       </div> \
                       <div id="chat-box-textField"><textarea id="msgToSend" placeholder="scrivi qualcosa..."></textarea></div> \
                       <div id="button-chatBox"><button id="sendMessage">Invia</button></div> \
                      </div>' ).insertAfter('.chat-div');

                 socketChat.emit('storico_messaggi',
                 {
                    'mittente': '{{dipendente.username}}',
                    'destinatario': collegaUsername,
                 });

                 $('.closeChatBox').click(function(){
                    $(this).parent().parent().parent().remove();
                 });

                 $('#sendMessage').click(function(){

                    var msg=$('#msgToSend').val();

                    if( msg != "" )
                    {
                        $('.speech-wrapper').append(
                            '<div class="bubble alt"> \
                                <div class="txt"> \
                                    <p class="name alt">Io</p> \
                                    <p class="message">'+msg+'</p><br/> \
                                    <span class="timestamp timestampToSet"></span> \
                                </div> \
                                <div class="bubble-arrow alt"></div>\
                            </div>'
                        );

                        var countBubble = 1;

                        $('.bubble').each(function(){
                            countBubble = countBubble+1;
                        });

                        var countBubble = countBubble;


                        $('.speech-wrapper').animate({scrollTop: $('.speech-wrapper').height()*countBubble}, 0);

                        socketChat.emit( "chat_message",
                         {
                            "mittente": "{{dipendente.username}}",
                            "destinatario": collegaUsername,
                            "testo": msg

                         } );
                        $('#msgToSend').val('');
                    }

                 });

            });

            socketChat.on('impostaTimestamp', function(msg){

                $('.timestampToSet').text( msg['data'] +' - '+msg['ora'])
                $('.timestampToSet').removeClass('timestampToSet');

            });

            socketChat.on('nuovoMessaggio', function(msg){



                if( $('#chat-box').hasClass(msg['mittente']) ){
                    $('.speech-wrapper').append(msg['htmlMsg']);

                    var countBubble = 1;

                    $('.bubble').each(function(){
                        countBubble = countBubble+1;
                    });

                    var countBubble = countBubble;


                    $('.speech-wrapper').animate({scrollTop: $('.speech-wrapper').height()*countBubble}, 0);
                }
                else
                {
                    $('.mittente').addClass('blink');
                    $('#ulListColleghi label.'+msg['mittente']).addClass('blink');
                    $('#openCloseChat a').addClass('blink');

                    $('.blink').click(function(){
                        $(this).removeClass('blink');
                    });

                }



            });

            socketChat.on('stampaStorico', function(msg){

                $('.speech-wrapper').html(msg['htmlChat']);

                var countBubble = 1;

                $('.bubble').each(function(){
                    countBubble = countBubble+1;
                });

                var countBubble = countBubble;


                $('.speech-wrapper').animate({scrollTop: $('.speech-wrapper').height()*countBubble}, 0);

            });

        </script>
    </body>
</html>