{% extends "paginaClienteBase.html" %}

{% block content %}

<div id="wrapper" class="col-md-8">
    <section id="one" class="wrapper style2 spotlights">
        <div class="inner innerPreventivo">
            <h2 class="titleInCentro">Preventivo #{{codicePreventivo}} <a href="{{url_for('clientBack')}}" class="fa fa-compress expandPreventivoIcon"></a></h2>
            <div id="divFattura" class="features row">
                <div class="col-md-4">
                    <span>Settore di Lavorazione</span></br>
                    <div>
                        <select id="selectSettore" class="js-select2" name="service">
                            {% for settore in settori %}
                                <option>{{settore.nome}}</option>
                            {% endfor %}
                        </select>
                        <div class="dropDownSelect2"></div>
                    </div>
                    <!-- Serve un metodo per ricordare le classi aggiunte dinamicamente ai bottoni
                       del "dropDownSelect2"; per far cio' creo un div perennemente invisibile
                        in cui memorizzo di dati che voglio -->
                    <div id="memoriaLavorazioniAggiunte">
                        {% for settore in settori %}
                            <div id="memoriaLavorazioniAggiunte-{{settore.nome}}" class="settoreMemorizzato">
                            <!--
                                Esempio struttura di #memoriaLavorazioniAggiunte

                                '<div class="<id-del-bottone>">'+
                                    '<span class="classeToAdd">aggiunto-'+count+'</span>'+
                                '</div>'
                             -->
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div  id="divElementFattura" class="features col-md-8">
                    <ul id="listaElementFattura">

                    </ul>

                </div>


            </div>
            <div id="tabContainer" class="features">
                <div id="tabFattura" class="table-wrapper">
                        <table class="alt">
                           <tbody id="bodyPreventivo">

                            </tbody>
                            <tfoot>

                            </tfoot>
                        </table>
                    </div>
            </div>
            <div id="divTotale" >

            </div>
            <div id="divSalvaPreventivo" class="features">
                <a id="saveButton">Salva</a>
            </div>
        </div>
    </section>
</div>

<script>

        var socketPreventivo= io.connect("{{sockUrl}}"+'/preventivoEdile');


        function settaLastElement(settore){

            $('tr[id^='+settore+'_trBody]').last().addClass(settore+'_lastAdded');
        }

        function righeDimensioniSottolavorazione(unita, prezzoBase, numElement){

            if( unita == "cad" ){

                return  '<td class="tdPreventivo inputField numColSmall basePrezzo-'+prezzoBase+' inputPrev"><input class="numInput inputPrev-'+numElement+' numero" type="number" name="numero" placeholder="numero" value=1></td>'+
                        '<td class="tdPreventivo numColSmall"></td>'+
                        '<td class="tdPreventivo numColSmall"></td>'+
                        '<td class="tdPreventivo numColSmall"></td>'+
                        '<td class="tdPreventivo totDimensioni colSmall"></td>'
            }
            else if ( unita == "ml" ){
                return  '<td class="tdPreventivo inputField numColSmall basePrezzo-'+prezzoBase+' inputPrev"><input class="numInput inputPrev-'+numElement+' numero" type="number" name="numero" placeholder="numero" value=1></td>'+
                        '<td class="tdPreventivo inputField numColSmall basePrezzo-'+prezzoBase+' inputPrev"><input class="numInput inputPrev-'+numElement+' larghezza" type="number" step="0.01" name="L" placeholder="L" value=1.00></td>'+
                        '<td class="tdPreventivo numColSmall"></td>'+
                        '<td class="tdPreventivo numColSmall"></td>'+
                        '<td class="tdPreventivo totDimensioni colSmall"></td>'
            }
            else if ( unita == "mq" ){
                return  '<td class="tdPreventivo inputField numColSmall basePrezzo-'+prezzoBase+' inputPrev"><input class="numInput inputPrev-'+numElement+' numero" type="number" name="numero" placeholder="numero" value=1></td>'+
                        '<td class="tdPreventivo inputField numColSmall basePrezzo-'+prezzoBase+' inputPrev"><input class="numInput inputPrev-'+numElement+' larghezza" type="number" step="0.01" name="L" placeholder="L" value=1.00></td>'+
                        '<td class="tdPreventivo inputField numColSmall basePrezzo-'+prezzoBase+' inputPrev"><input class="numInput inputPrev-'+numElement+' altezza" type="number" step="0.01" name="L" placeholder="H" value=1.00></td>'+
                        '<td class="tdPreventivo numColSmall"></td>'+
                        '<td class="tdPreventivo totDimensioni colSmall"></td>'
            }
            else if( unita == "mc" ){
                return  '<td class="tdPreventivo inputField numColSmall basePrezzo-'+prezzoBase+' inputPrev"><input class="numInput inputPrev-'+numElement+' numero" type="number" name="numero" placeholder="numero" value=1></td>'+
                        '<td class="tdPreventivo inputField numColSmall basePrezzo-'+prezzoBase+' inputPrev"><input class="numInput inputPrev-'+numElement+' larghezza" type="number" step="0.01" name="L" placeholder="L" value=1.00></td>'+
                        '<td class="tdPreventivo inputField numColSmall basePrezzo-'+prezzoBase+' inputPrev"><input class="numInput inputPrev-'+numElement+' altezza" type="number" step="0.01" name="L" placeholder="H" value=1.00></td>'+
                        '<td class="tdPreventivo inputField numColSmall basePrezzo-'+prezzoBase+' inputPrev"><input class="numInput inputPrev-'+numElement+' profondita" type="number" step="0.01" name="L" placeholder="P" value=1.00></td>'+
                        '<td class="tdPreventivo totDimensioni colSmall"></td>'

            }
        }


        function costruisciPreventivo(){
            var counterLavorazioni = 1;
            {% for settore in infoPreventivo[0] %}

                  $('#bodyPreventivo').append(

                            '<tr class="trHead {{settore}}">'+
                                '<td  colspan="10"  class="titleSettoreTd">{{settore}}</td>'+
                            '</tr>'+
                            '<tr class="trHead {{settore}}_head">'+
                                '<th class="thPreventivo"></th>'+
                                '<th class="thPreventivo"></th>'+
                                '<th class="thPreventivo numColSmall">N</th>'+
                                '<th class="thPreventivo numColSmall">L</th>'+
                                '<th class="thPreventivo numColSmall">H</th>'+
                                '<th class="thPreventivo numColSmall">P</th>'+
                                '<th class="thPreventivo colSmall">Quantità</th>'+
                                '<th class="thPreventivo numColSmall">Unità</th>'+
                                '<th class="thPreventivo colSmall">Prezzo unitario</th>'+
                                '<th class="thPreventivo">Totale</th>'+
                            '</tr>'

                  );


                {% for lavorazione in infoPreventivo[1] %}
                    {% if lavorazione[0].settore == settore %}


                        var rowsToAdd='<tr id="{{settore}}_trBody-{{lavorazione[0].ordine}}" class="trBody">'+
                                            '<td class="firstCol{{lavorazione[0].ordine}} firstCol"></td>'+
                                            '<td class="tdPreventivo tdLavorazione"><textarea>{{prezzario.tipologia_lavorazione}}</textarea></td>'+
                                            '<td class="tdPreventivo numColSmall"></td>'+
                                            '<td class="tdPreventivo numColSmall"></td>'+
                                            '<td class="tdPreventivo numColSmall"></td>'+
                                            '<td class="tdPreventivo numColSmall"></td>'+
                                            '<td class="tdPreventivo numColSmall"></td>'+
                                            '<td class="tdPreventivo numColSmall"></td>'+
                                            '<td class="tdPreventivo prezzoBase colSmall">&euro; {{lavorazione[0].prezzoMax}}</td>'+
                                            '<td ></td>'+
                                        '</tr>';

                        $('#bodyPreventivo').append( rowsToAdd );

                        {% for sottolavorazione in lavorazione[3] %}

                            var rowsToAdd='<tr class="{{settore}}_trSottolavorazione-{{lavorazione[0].ordine}} sottolavNum-{{sottolavorazione.ordine_sottolavorazione}}">'+
                                                '<td colspan="2"><a class="delSottolavorazione fa fa-trash"></a></td>'+
                                                righeDimensioniSottolavorazione( '{{lavorazione[0].unitaMisura}}',
                                                                                  '{{lavorazione[0].prezzoMax}}',
                                                                                  '{{lavorazione[0].ordine}}')+
                                                '<td class="tdPreventivo numColSmall">{{lavorazione[0].unitaMisura}}</td>'+
                                                '<td class="tdPreventivo colSmall"></td>'+
                                                '<td class="totalSottolavorazione"></td>'+
                                            '</tr>';

                            $('#bodyPreventivo').append( rowsToAdd );

                        { % endfor %}

                        #aggiungo il footer

                        var rowsToAdd= '<tr class="trFoot{{lavorazione[0].ordine}} trFoot {{settore}}_trFoot unitaMisura-{{lavorazione[0].unitaMisura}}">'+
                                                '<td colspan="6"></td>'+
                                                '<td class="quantita colSmall">{{lavorazione[1]}}</td>'+
                                                '<td>{{lavorazione[0].unitaMisura}}</td>'+
                                                '<td colSmall"></td>'+
                                                '<td class="footTot">{{lavorazione[2]}}</td>'+
                                            '</tr>';
                    {% endif %}
                {% endfor %}
            {% endfor %}
        }


        function calcolaTotalePreventivo(){
            var totale = 0;

            $('.trBody').each(function(){
                    var numEl = $(this).attr('id').split('-')[1];
                    totale+=parseFloat($('.trFoot'+numEl).children('.footTot').text().split(' ')[1]);

            });

            $('#divTotale').html('<span><u>Totale:</u> &euro; ' + Math.round(totale*100)/100 + '</span>' );
        }

        function calcolaTotaleParziale(settore, numOfEl){
                var total = parseFloat($('#'+settore+'_trBody-'+numOfEl).children('.totalSottolavorazione').text().split(' ')[1]);
                var quantita = parseFloat($('#'+settore+'_trBody-'+numOfEl).children('.totDimensioni').text());

                $('.'+settore+'_trAdded-'+numOfEl).each(function(){
                    total+=parseFloat($(this).children('.totalSottolavorazione').text().split(' ')[1]);
                    quantita+=parseFloat($(this).children('.totDimensioni').text());
                });

                $('.trFoot'+numOfEl).children('.footTot').html("&euro; "+ Math.round(total*100)/100 );
                $('.trFoot'+numOfEl).children('.quantita').html(quantita);


            calcolaTotalePreventivo()
        }



        function calcolaTotaleRigaSottolavorazione(classeElemento, ordineSottolav, prezzoBase){
            /*
                Il paramentro "classeElemento" ha la forma: "<settore>_trAdded-<ordineLavorazione>"
                Il parametro "ordineSottolav" ha la forma: "sottolavNum-<ordineSottolavorazione>"

            */


            $('.'+classeElemento).each(function(){


                if($(this).hasClass(ordineSottolav)){
                    var totalePrezzo=prezzoBase;
                    var quantita=1;

                    $(this).children('td.inputField').each(function(){
                       quantita=quantita*parseFloat($(this).children('input').val());

                    });

                    totalePrezzo=parseFloat(totalePrezzo)*quantita;


                    $(this).children('td.totDimensioni').text( Math.round(quantita*100)/100 );
                    $(this).children('td.totalSottolavorazione').html( "&euro; " + Math.round(totalePrezzo*100)/100 );
                }
            });

            calcolaTotaleParziale(classeElemento.split('_')[0], classeElemento.split('-')[1]);
        }


        var ordineLavorazioni = 0;

        function aggiungiRiga($this){
                 if( $this.hasClass('aggiunto') ){
                    console.log( "Devo prendere: " + $this.attr('class').split(" ")[1] + " riga num: " + $this.attr('class').split(" ")[3].split("-")[1] );
                 }else{
                     {% for prezzario in prezzarioEdile %}
                        if( "{{prezzario.tipologia_lavorazione}}" ==  $this.text() ){

                            //Segno nel bottono cliccato che e' una lavorazione aggiunto
                            $this.addClass("aggiunto-"+ordineLavorazioni);
                            $this.addClass("aggiunto");

                            /*memorizzo nel apposita sezione l'aggiunta della classe "aggiunto-"+ordineLavorazioni al bottone*/
                            $("#memoriaLavorazioniAggiunte-{{prezzario.settore}}").append(
                                '<div class="'+$this.attr('id')+'">'+
                                    '<span class="classeToAdd">aggiunto-'+ordineLavorazioni+'</span>'+
                                '</div>'

                            );


                            var sezioneSettore =  $('#bodyPreventivo').children('.{{prezzario.settore}}');

                            #se non e' gia' stata aggiunta una sezione
                            if( !sezioneSettore.length ){

                                $('#bodyPreventivo').append(

                                    '<tr class="trHead {{prezzario.settore}}">'+
                                        '<td  colspan="10"  class="titleSettoreTd">{{prezzario.settore}}</td>'+
                                    '</tr>'+
                                    '<tr class="trHead {{prezzario.settore}}_head">'+
                                        '<th class="thPreventivo"></th>'+
                                        '<th class="thPreventivo"></th>'+
                                        '<th class="thPreventivo numColSmall">N</th>'+
                                        '<th class="thPreventivo numColSmall">L</th>'+
                                        '<th class="thPreventivo numColSmall">H</th>'+
                                        '<th class="thPreventivo numColSmall">P</th>'+
                                        '<th class="thPreventivo colSmall">Quantità</th>'+
                                        '<th class="thPreventivo numColSmall">Unità</th>'+
                                        '<th class="thPreventivo colSmall">Prezzo unitario</th>'+
                                        '<th class="thPreventivo">Totale</th>'+
                                    '</tr>'

                                );
                            }

                            //Preparo la riga della lavorazione
                            var rowsToAdd='<tr id="{{prezzario.settore}}_trBody-'+ordineLavorazioni+'" class="trBody {{prezzario.settore}}_lastAdded">'+
                                            '<td class="firstCol'+ordineLavorazioni+' firstCol"></td>'+
                                            '<td class="tdPreventivo tdLavorazione"><textarea>{{prezzario.tipologia_lavorazione}}</textarea></td>'+
                                            '<td class="tdPreventivo numColSmall"></td>'+
                                            '<td class="tdPreventivo numColSmall"></td>'+
                                            '<td class="tdPreventivo numColSmall"></td>'+
                                            '<td class="tdPreventivo numColSmall"></td>'+
                                            '<td class="tdPreventivo numColSmall"></td>'+
                                            '<td class="tdPreventivo numColSmall"></td>'+
                                            '<td class="tdPreventivo numColSmall"></td>'+
                                            '<td class="tdPreventivo prezzoBase colSmall">&euro; {{prezzario.prezzoMax}}</td>'+
                                            '<td></td>'+
                                        '</tr>'+
                                        '<tr class="{{prezzario.settore}}_trSottolavorazione-'+ordineLavorazioni+' sottolavNum-0">'+
                                                '<td colspan="2"><a class="delSottolavorazione fa fa-trash"></a></td>'+
                                                righeDimensioniSottolavorazione( '{{prezzario.unitaMisura}}',
                                                                                  '{{prezzario.prezzoMax}}',
                                                                                   ordineLavorazioni)+
                                                '<td class="tdPreventivo numColSmall">{{lavorazione[0].unitaMisura}}</td>'+
                                                '<td class="tdPreventivo colSmall"></td>'+
                                                '<td class="totalSottolavorazione"></td>'+
                                        '</tr>'+
                                        '<tr class="trFoot'+ordineLavorazioni+' trFoot {{prezzario.settore}}_trFoot unitaMisura-{{prezzario.unitaMisura}}">'+
                                                '<td colspan="6"></td>'+
                                                '<td class="quantita colSmall"></td>'+
                                                '<td>{{prezzario.unitaMisura}}</td>'+
                                                '<td colSmall"></td>'+
                                                '<td class="footTot"></td>'+
                                         '</tr>';

                            $(".{{prezzario.settore}}_lastAdded").removeClass("{{prezzario.settore}}_lastAdded");
                            $('.{{prezzario.settore}}_trFoot').last().after( rowsToAdd );

                            calcolaTotaleRigaSottolavorazione('{{prezzario.settore}}_trBody-'+ordineLavorazioni, parseFloat('{{prezzario.prezzoMax}}') );

                            /*Ogni volta che un inputField viene modificato: ricalcola il totale della riga */
                            $('.inputPrev-'+ordineLavorazioni).on('input', function(){
                                     calcolaTotaleRigaSottolavorazione('{{prezzario.settore}}_trBody-'+ordineLavorazioni, parseFloat('{{prezzario.prezzoMax}}') );
                            });


                            $('tr.trBody').draggable({ helper: "clone"});


                            /*registro la riga nel database*/
                            socketPreventivo.emit("add_nuova_lavorazione",
                                                    {
                                                        "numero_preventivo" : "{{preventivo.numero_preventivo}}",
                                                        "data" : "{{preventivo.data}}",
                                                        "settore" : "{{prezzario.settore}}",
                                                        "lavorazione" : "{{prezzario.tipologia_lavorazione}}",
                                                        "unitaMisura" : "{{prezzario.unitaMisura}}",
                                                        "ordine": count,
                                                        "prezzoUnitario" : "{{prezzario.prezzoMax}}"

                                                    }

                                                  );


                            /*ad ogni nuova aggiunta di elemento rinumera tuttoquanto*/
                            rienumeraPagina()

                            //Aggiungo funzionalita' ai "bottoni" nelle righe del preventivo e i bottoni stessi...
                             $('.trBody').each(function(){

                                  var numEl = $(this).attr('id').split('-')[1];

                                  //aggiungo i bottoni
                                  $(this).children('td.firstCol').html( '<label>'+ numEl + '</label><br/><a class="delElement fa fa-trash"></a><a class="ctrButton addElement fa fa-plus add-'+numEl+'">' );


                                  //aggiungo la funzione 'cancellaLavorazione' al relativo bottone
                                  $(this).children('td.firstCol').children('a.delElement').click(function(){
                                        var idElementToDel=$(this).parent().parent().attr('id');
                                        var numEl = idElementToDel.split('-')[1];
                                        var settore =idElementToDel.split('_')[0];
                                        var lastEl = $('#'+idElementToDel).hasClass(settore+'_lastAdded'); //variabile booleana

                                        $('#'+idElementToDel).remove();
                                        $('.'+settore+'_trSottolavorazione-'+numEl).remove();
                                        $('.trFoot'+numEl).remove();

                                        $('#memoriaLavorazioniAggiunte-'+settore).children('div').each(function(){
                                            if( $(this).text() == 'aggiunto-'+numEl )
                                                $(this).remove();
                                        });

                                        $('.aggiunto-'+numEl).removeClass('aggiunto');
                                        $('.aggiunto-'+numEl).removeClass('aggiunto-'+numEl);

                                        socketPreventivo.emit("elimina_lavorazione",
                                                        {
                                                            "numero_preventivo" : "{{preventivo.numero_preventivo}}",
                                                            "data" : "{{preventivo.data}}",
                                                            "ordine": numEl,

                                                        }

                                        );

                                        rienumeraPagina();

                                        if( lastEl ){
                                            settaLastElement(settore);
                                        }

                                        calcolaTotalePreventivo();
                                  });

                                  //aggiungo la funzione 'aggiungiSottolavorazione' al relativo bottone
                                  $(this).children('td.firstCol').children('a.add-'+numEl).click( function(){

                                        var settore= $(this).parent().parent().attr('id').split('_')[0];
                                        var numElement = $(this).attr('class').split(' ')[4].split('-')[1];

                                        var unitaMisura = $('.trFoot'+numElement).attr('class').split(' ')[3].split('-')[1];

                                        var prezzoUnitarioWithEuro = $('#'+settore+'_trBody-'+numElement).children('.prezzoBase').text();
                                        var prezzoUnitario = prezzoUnitarioWithEuro.split(' ')[1];


                                        //Aggiungo una nuova riga prima del totale parziale ( rappresentato dalla classe trFoot )
                                        $('.trFoot'+numElement).before(
                                            '<tr class="'+settore+'_trSottolavorazione-'+numElement+'">'+
                                                '<td colspan="2"><a class="delSottolavorazione fa fa-trash"></a></td>'+
                                                righeDimensioniAdded( unitaMisura, prezzoUnitario, numElement)+
                                               '<td class="tdPreventivo numColSmall">'+unitaMisura+'</td>'+
                                                '<td class="tdPreventivo colSmall"></td>'+
                                                '<td class="totalSottolavorazione"></td>'+
                                            '</tr>'

                                        );

                                        calcolaTotaleParziale(settore, numElement);

                                        //numero ogni "sottoriga aggiunta" e calcolo il totale della riga
                                        var aux=0;

                                        $('.'+settore+'_trAdded-'+numElement).each(function(){

                                            $(this).addClass('addedNum'+aux);
                                            calcolaTotaleRigaAdded( settore+'_trSottolavorazione-'+numElement, 'sottolavNum-'+aux ,parseFloat(prezzoUnitario));
                                            aux+=1;
                                        });


                                        //Alla variazione di un InputField aggiorna i totali e il db
                                        $('.inputPrev-'+numElement).on('input', function(){

                                            var classesOfRow = $(this).parent().parent().attr('class').split(' ');
                                            calcolaTotaleRigaSottolavorazione(classesOfRow[0], classesOfRow[1], prezzoBase);

                                            //recupero le informazioni per registrare la modifica nel db

                                            var ordine = parseInt(classesOfRow[0].split('-')[1]);
                                            var ordineSottolavorazione = parseInt(classesOfRow[1].split('-')[1])+1;


                                            var unitaMisura = $('.trFoot'+ordine).attr('class').split(' ')[3].split('-')[1];


                                            numero =parseFloat($(this).val());
                                            variabile =$(this).attr('class').split(' ')[2];

                                            messaggio = '{ '+
                                                            '"numero_preventivo" : "{{preventivo.numero_preventivo}}", '+
                                                            '"data" : "{{preventivo.data}}", '+
                                                            '"ordine" : "' + ordine + '", '+
                                                            '"ordine_sottolavorazione" : "'+  ordineSottolavorazione + '", '+
                                                            '"unitaMisura" : "'+ unitaMisura+ '", '+
                                                            '"'+ variabile +'" : "'+ numero+ '"}';

                                            socketPreventivo.emit("modifica_sottolavorazione", messaggio);



                                        });



                                        $('.delSottolavorazione').on( 'click', function(){

                                            var sottolavorazioniCommonClass=$(this).parent().parent().attr('class').split(' ')[0];
                                            $(this).parent().parent().remove();


                                            //rienumero i sottoelementi restanti
                                            var aux=0;
                                            $('.'+sottolavorazioniCommonClass).each(function(){
                                                $(this).removeClass();
                                                $(this).addClass(sottolavorazioniCommonClass);
                                                $(this).addClass('sottolavNum-'+aux);
                                                aux+=1;
                                            });


                                            var sett=sottolavorazioniCommonClass.split('_')[0];
                                            var num=sottolavorazioniCommonClass.split('-')[1];
                                            calcolaTotaleParziale(sett, num);


                                            var ordine_sottolavorazione=$(this).parent().parent().attr('class').split(' ')[1].split('-')[1];


                                            socketPreventivo.emit("elimina_sottolavorazione",
                                                {
                                                    "numero_preventivo" : "{{preventivo.numero_preventivo}}",
                                                    "data" : "{{preventivo.data}}",
                                                    "ordine": numElement,
                                                    "ordine_sottolavorazione": ordine_sottolavorazione

                                                }

                                            );

                                        }); // FINE delSottolavorazione

                                        socketPreventivo.emit("add_nuova_sottolavorazione",
                                        {
                                            "numero_preventivo" : "{{preventivo.numero_preventivo}}",
                                            "data" : "{{preventivo.data}}",
                                            "ordine": numElement

                                        }

                                   );

                                  }); //FINE addSottolavorazione

                                  ordineLavorazioni++;


                             });

                        }
                     {% endfor %}
                 }

        }

       var counter=0;

       {% for elemento in prezzarioEdile %}
          if( "{{elemento.settore}}" == $('#selectSettore').val() ){
            $('#listaElementFattura').append(

                 '<li><button id="button'+ counter +'" onclick="aggiungiRiga($(this))" class="elementFattura {{elemento.settore}}"><label for="button'+ counter +'">{{elemento.tipologia_lavorazione}}</label></button></li>'
            );
            counter+=1;
          }
       {% endfor %}


       $('#selectSettore').change(function(){

            counter=0;
            $('#listaElementFattura').html("");
            {% for elemento in prezzarioEdile %}

              if( "{{elemento.settore}}" == $('#selectSettore').val() ){

                var classesToAdd='';

                /*Riaggiungo le classi dinamiche che il change() toglierebbe*/
                $('#memoriaLavorazioniAggiunte-{{elemento.settore}}').children('div').each(function(){
                    if($(this).hasClass('button'+counter)){
                        classesToAdd="aggiunto "+ $(this).text();
                    }

                });


                $('#listaElementFattura').append(

                     '<li><button id="button'+ counter +'" onclick="aggiungiRiga($(this))" class="elementFattura {{elemento.settore}} '+classesToAdd+'"><label for="button'+ counter +'">{{elemento.tipologia_lavorazione}}</label></button></li>'
                );
                counter+=1;

              }

           {% endfor %}


       });
































</script>

{% endblock %}