<!DOCTYPE HTML>
<!--
	Hyperspace by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html lang="it" data-ng-app="materialAdmin" data-ng-controller="materialadminCtrl as mactrl">
	<head>
		<title>Cliente {{cliente.nome}} {{cliente.cognome}}</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />


<!--==================================================================================================-->
    <!-- Vendor CSS -->
    <link href="{{url_for('static', filename='headerAndForm/vendors/bower_components/animate.css/animate.min.css') }}" rel="stylesheet">
    <link href="{{url_for('static', filename='headerAndForm/vendors/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.min.css') }}" rel="stylesheet">
    <link href="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-loading-bar/src/loading-bar.css') }}" rel="stylesheet">


    <!-- CSS -->
    <link href="{{url_for('static', filename='headerAndForm/css/app.css') }}" rel="stylesheet">
    <link href="{{url_for('static', filename='headerAndForm/css/demo.css') }}" rel="stylesheet">


<!--=================================================================================================-->

    <link href="{{url_for('static', filename='bootstrap/css/normalize.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="{{url_for('static', filename='css/font-awesome.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="{{url_for('static', filename='bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">

<!--==================== css form registrazione e profilo =============================================-->

    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/fonts/iconic/css/material-design-iconic-font.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/vendor/animate/animate.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/vendor/css-hamburgers/hamburgers.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/vendor/animsition/css/animsition.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/vendor/select2/select2.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/vendor/daterangepicker/daterangepicker.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/vendor/noui/nouislider.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/css/util.css') }}">

    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='form/css/main.css') }}">
<!--===============================================================================================-->

    <link rel="stylesheet" href="{{url_for('static', filename='css/gestioneDip.css') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/registraDipendente.css') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/profiloDip.css') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/button-modificaProfilo.css') }}">

<!--==================== css calendario e agenda====== =============================================-->
    <link href="{{url_for('static', filename='calendario/fullcalendar.min.css') }}" rel='stylesheet' />
    <link href="{{url_for('static', filename='calendario/fullcalendar.print.min.css') }}" rel='stylesheet' media='print' />

    <script src="{{url_for('static', filename='js/vendor/jquery-1.10.2.min.js') }}"></script>

    <script src="{{url_for('static', filename='calendario/lib/moment.min.js') }}"></script>
    <script src="{{url_for('static', filename='calendario/fullcalendar.min.js') }}"></script>
    <script src="{{url_for('static', filename='calendario/locale/it.js') }}"></script>
<!--===============================================================================================-->

    <link href="{{url_for('static', filename='headerAndForm/vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.css') }}" rel='stylesheet' />
    <script src="{{url_for('static', filename='js/vendor/sweet-alert2.min.js') }}"></script>

<!--===============================favicons =========================================================-->


    <link rel="apple-touch-icon" sizes="57x57" href="{{url_for('static', filename='favicon/apple-icon-57x57.png') }}">
    <link rel="apple-touch-icon" sizes="60x60" href="{{url_for('static', filename='favicon/apple-icon-60x60.png') }}">
    <link rel="apple-touch-icon" sizes="72x72" href="{{url_for('static', filename='favicon/apple-icon-72x72.png') }}">
    <link rel="apple-touch-icon" sizes="76x76" href="{{url_for('static', filename='favicon/apple-icon-76x76.png') }}">
    <link rel="apple-touch-icon" sizes="114x114" href="{{url_for('static', filename='favicon/apple-icon-114x114.png') }}">
    <link rel="apple-touch-icon" sizes="120x120" href="{{url_for('static', filename='favicon/apple-icon-120x120.png') }}">
    <link rel="apple-touch-icon" sizes="144x144" href="{{url_for('static', filename='favicon/apple-icon-144x144.png') }}">
    <link rel="apple-touch-icon" sizes="152x152" href="{{url_for('static', filename='favicon/apple-icon-152x152.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{url_for('static', filename='favicon/apple-icon-180x180.png') }}">
    <link rel="icon" type="image/png" sizes="192x192"  href="{{url_for('static', filename='favicon/android-icon-192x192.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{url_for('static', filename='favicon/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="96x96" href="{{url_for('static', filename='favicon/favicon-96x96.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{url_for('static', filename='favicon/favicon-16x16.png') }}">
    <link rel="manifest" href="{{url_for('static', filename='favicon/manifest.json') }}">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="{{url_for('static', filename='favicon/ms-icon-144x144.png') }}">
    <meta name="theme-color" content="#ffffff">

<!--===================================socket io====================================================-->
    <script src="{{url_for('static', filename='js/vendor/socket.io.js') }}"></script>
    <!--===========================================================================================================-->

        <!-- Angular -->
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular/angular.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-animate/angular-animate.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-resource/angular-resource.min.js') }}"></script>

        <!-- Angular Modules -->
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-ui-router/release/angular-ui-router.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-loading-bar/src/loading-bar.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/oclazyload/dist/ocLazyLoad.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-bootstrap/ui-bootstrap-tpls.min.js') }}"></script>

        <!-- Common Vendors -->
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/jquery.nicescroll/jquery.nicescroll.min.js') }}"></script>

        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/Waves/dist/waves.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bootstrap-growl/bootstrap-growl.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/ng-table/dist/ng-table.min.js') }}"></script>



        <!-- Using below vendors in order to avoid misloading on resolve -->
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/flot/jquery.flot.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/flot.curvedlines/curvedLines.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/flot/jquery.flot.resize.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/moment/min/moment.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/fullcalendar/dist/fullcalendar.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/flot-orderBars/js/jquery.flot.orderBars.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/flot/jquery.flot.pie.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/flot.tooltip/js/jquery.flot.tooltip.min.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/vendors/bower_components/angular-nouislider/src/nouislider.min.js') }}"></script>

        <!-- App level -->
        <script src="{{url_for('static', filename='headerAndForm/js/app.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/config.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/controllers/main.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/services.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/templates.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/controllers/ui-bootstrap.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/controllers/table.js') }}"></script>


        <!-- Template Modules -->
        <script src="{{url_for('static', filename='headerAndForm/js/modules/template.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/ui.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/charts/flot.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/charts/other-charts.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/form.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/media.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/components.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/calendar.js') }}"></script>
        <script src="{{url_for('static', filename='headerAndForm/js/modules/demo.js') }}"></script>

<!--===========================================================================================================-->
		 <link rel="stylesheet" href="{{url_for('static', filename='swal-forms/swal-forms.css') }}">
         <link rel="stylesheet" href="{{url_for('static', filename='swal-forms/sweet-alert.css') }}">
         <script src="{{url_for('static', filename='swal-forms/sweet-alert.js') }}"></script>
         <script src="{{url_for('static', filename='swal-forms/swal-forms.js') }}"></script>



		<!--[if lte IE 8]><script src="{{url_for('static', filename='paginaCliente/assets/js/ie/html5shiv.js') }}"></script><![endif]-->
		<link rel="stylesheet" href="{{url_for('static', filename='paginaCliente/assets/css/main.css') }}" />
		<!--[if lte IE 9]><link rel="stylesheet" href="{{url_for('static', filename='paginaCliente/assets/css/ie9.css') }}" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="{{url_for('static', filename='paginaCliente/assets/css/ie8.css') }}" /><![endif]-->
	</head>
	<body data-ng-class="{ 'sw-toggled': mactrl.layoutType === '1', 'modal-open': mactrl.sidebarToggle.left === true }">


	<header id="header" data-ng-include="'header'" data-ng-controller="headerCtrl as hctrl"></header>
  <aside id="sidebar" data-ng-include="'sidebarLeft'" data-ng-class="{ 'toggled': mactrl.sidebarToggle.left === true }"></aside>

	<aside id="chat" data-ng-include="'/static/headerAndForm/template/chat.html'" data-ng-class="{ 'toggled': mactrl.sidebarToggle.right === true }"></aside>

	<div class="row">
		<!-- Sidebar -->
			<div class="col-md-2">
			<section id="sidebar-client">
				<div class="inner">
					<nav>
						<ul>
							<li><a class="menuBar local" href="#intro">Profilo cliente</a></li>
							<li><a class="menuBar local" href="#one">Preventivo</a></li>
                            <li><a class="menuBar local" href="#two">Scelta finiture</a></li>
                        </ul>
					</nav>
				</div>
			</section>
			</div>

		<!-- Wrapper -->
			<div id="wrapper" class="col-md-10">

				<!-- Intro -->
					<section id="intro" class="wrapper style1 fullscreen fade-up">
						<div class="inner">
							<h1>{{cliente.nome}} {{cliente.cognome}}</h1>
							{% if cliente.difficolta == "facile" %}
								<span>Livello: 1</span>
							{% elif  cliente.difficolta == "media" %}
								<span>Livello: 2</span>
							{% elif  cliente.difficolta == "alta" %}
								<span>Livello: 3</span>
							{% endif %}

							<span>	Tipologia: {{cliente.tipologia}} </span>

							<div class="row">
								<div class="col-md-6">
									<ul class="contact">
										<li>
											<h3>Indirizzo:</h3>
											<span>{{cliente.indirizzo}}</span>
										</li>
										<li>
											<h3>Email:</h3>
											<a href="#">{{cliente.email}}</a>
										</li>
										<li>
											<h3>Telefono:</h3>
											<span>{{cliente.telefono}}</span>
										</li>
										<li>
											<h3>Lavorazione in corso:</h3>
												<span>{{cliente.lavorazione}}</span>
										</li>
										<li>
											<h3>Sopraluogo:</h3>
											{% if not cliente.sopraluogo %}
												<span>Non necessario</span>
											{% else %}
												<span>{{cliente.datasopralugo}}</span>
											{% endif %}
											<br/><br/><br/>
											<a class="button">Imposta data sopraluogo</a>
										</li>
									</ul>
								</div>
								<div class="col-md-6">
									{%if dipendente.dirigente %}

									<ul class="contact">
										<h2>Dipendenti associati al cliente:</h2>
											<li>
												<h3>Ufficio commerciale:</h3>
												{% for dip  in ufficioCommerciale %}
													<span>{{dip.nome}} {{dip.cognome}}</span><br/>
												{% endfor %}
											</li>
											<li>
												<h3>Ufficio tecnico:</h3>
												{% for dip  in ufficioTecnico %}
													<span>{{dip.nome}} {{dip.cognome}}</span><br/>
												{% endfor %}

											</li>
											<li>
												<h3>Ufficio capicantiere:</h3>
												{% for dip  in ufficioCapicantiere %}
													<span>{{dip.nome}} {{dip.cognome}}</span><br/>
												{% endfor %}

											</li>
									</ul>
									{% endif %}
								</div>
							<div>

						</div>
					</section>

				<!-- One -->
					<section id="one" class="wrapper style2 spotlights">
						<div class="inner">

							<span id="titlePreventivoSpan">
								<span><h2><a id="newPreventivo" class="fa fa-plus-circle expandPreventivoIcon"></a> Preventivi cliente</h2></span>

								{% if countPreventivi > 0 %}

									<span id="ctrlSpanPreventivo">
										<span class="aCtrlPreventivo">
										</span>
										<select id="preventivoSelect" >
											{% for prev in preventivi_distinti %}
												{% if prev[2] == lastPreventivo[0].numero_preventivo %}
													<option class="numeroPreventivo-{{prev[2]}}" selected="selected">{{prev[0]}} - US{{prev[1]}}</option>
												{% else %}
													<option class="numeroPreventivo-{{prev[2]}}">{{prev[0]}} - US{{prev[1]}}</option>
												{% endif %}
											{% endfor %}
										</select>
										<select id="dataSelect" >
										</select>


									</span>
								{% endif %}
							</span>


						</div>
					</section>

				<!-- Two -->
					<section id="two" class="wrapper style3 fade-up">
						<div class="inner">
                            <span id="titleSceltaFinitureoSpan">
								<span><h2><a id="newPreventivoFiniture" class="fa fa-plus-circle expandPreventivoIcon"></a> Scelta Finiture </h2></span>
								<span id="ctrlSpanPreventivoFiniture">
									<span class="aCtrlPreventivo">
									</span>
									<select id="preventivofinitureSelect" >

									</select>
									<select id="dataPreventivoFinitureSelect" >
									</select>


								</span>
							</span>
						</div>
					</section>

				<!-- Three -->
					<section id="three" class="wrapper style1 fade-up">
						<div class="inner">
							<h2>Get in touch</h2>
							<p>Phasellus convallis elit id ullamcorper pulvinar. Duis aliquam turpis mauris, eu ultricies erat malesuada quis. Aliquam dapibus, lacus eget hendrerit bibendum, urna est aliquam sem, sit amet imperdiet est velit quis lorem.</p>
							<div class="split style1">
								<section>
									<form method="post" action="#">
										<div class="field half first">
											<label for="name">Name</label>
											<input type="text" name="name" id="name" />
										</div>
										<div class="field half">
											<label for="email">Email</label>
											<input type="text" name="email" id="email" />
										</div>
										<div class="field">
											<label for="message">Message</label>
											<textarea name="message" id="message" rows="5"></textarea>
										</div>
										<ul class="actions">
											<li><a href="" class="button submit">Send Message</a></li>
										</ul>
									</form>
								</section>
								<section>
									<ul class="contact">
										<li>
											<h3>Address</h3>
											<span>12345 Somewhere Road #654<br />
											Nashville, TN 00000-0000<br />
											USA</span>
										</li>
										<li>
											<h3>Email</h3>
											<a href="#">user@untitled.tld</a>
										</li>
										<li>
											<h3>Phone</h3>
											<span>(000) 000-0000</span>
										</li>
										<li>
											<h3>Social</h3>
											<ul class="icons">
												<li><a href="#" class="fa-twitter"><span class="label">Twitter</span></a></li>
												<li><a href="#" class="fa-facebook"><span class="label">Facebook</span></a></li>
												<li><a href="#" class="fa-github"><span class="label">GitHub</span></a></li>
												<li><a href="#" class="fa-instagram"><span class="label">Instagram</span></a></li>
												<li><a href="#" class="fa-linkedin"><span class="label">LinkedIn</span></a></li>
											</ul>
										</li>
									</ul>
								</section>
							</div>
						</div>
					</section>

			</div>

		<!-- Scripts -->
			<!--================================= JS Form =================================================================-->
		   <script src="{{url_for('static', filename='form/vendor/animsition/js/animsition.min.js') }}"></script>
		   <script src="{{url_for('static', filename='form/vendor/bootstrap/js/popper.js') }}"></script>
		   <script src="{{url_for('static', filename='bootstrap/js/bootstrap.min.js') }}"></script>
		   <script src="{{url_for('static', filename='form/vendor/select2/select2.min.js') }}"></script>
	<!--===========================================================================================================-->
<!--
			<script src="{{url_for('static', filename='paginaCliente/assets/js/jquery.min.js') }}"></script> -->
			<script src="{{url_for('static', filename='paginaCliente/assets/js/jquery.scrollex.min.js') }}"></script>
			<script src="{{url_for('static', filename='paginaCliente/assets/js/jquery.scrolly.min.js') }}"></script>
			<script src="{{url_for('static', filename='paginaCliente/assets/js/skel.min.js') }}"></script>
			<script src="{{url_for('static', filename='paginaCliente/assets/js/util.js') }}"></script>
			<!--[if lte IE 8]><script src="{{url_for('static', filename='paginaCliente/assets/js/ie/respond.min.js') }}"></script><![endif]-->
			<script src="{{url_for('static', filename='paginaCliente/assets/js/main.js') }}"></script>

			<script>

				var totalePreventivo=0;
				{% for lavorazione in lastPreventivo[2] %}
					totalePreventivo += parseFloat('{{lavorazione[2]}}');
				{% endfor %}

				$('#totalePrev').children('span').html('Totale: &euro; ' + totalePreventivo);

				$('#header > a').css('border-bottom', 'None' );

   				var socketHome = io.connect("{{sockUrl}}"+'/home');


                socketHome.on('connect', function() {
                    console.log('connected listino');


                    socketHome.emit('registra_sid',   {'username': '{{dipendente.username}}'} );
                });


				var socketPreventivo= io.connect("{{sockUrl}}"+'/preventivoEdile');

/*
				var countLavorazioni=0;

				{% for preventivo in preventivi %}
					countLavorazioni++;
				{% endfor %}

				if(countLavorazioni){
					$('.aCtrlPreventivo').html(
							'<a id="modificaPreventivo" class="fa fa-edit expandPreventivoIcon"></a>'+
							'<a class="fa fa-trash expandPreventivoIcon"></a>'
					);

					$('#modificaPreventivo').click(function(){
					    var selPrev = $('#preventivoSelect option:selected');

						socketPreventivo.emit('modifica_preventivo', {'dip': '{{dipendente.username}}',
																	  'numero_preventivo': selPrev});
					});
				}*/

				/*Stampa l'antemprima del preventivo edile*/
				function stampaRiassuntoPreventivo( numero_preventivo, data ){

								$('section#one').children('.inner').children('.features').remove();

								strToAdd = '';
								{% for preventivo in preventivi %}
									if( "{{preventivo[0].numero_preventivo}}"  == numero_preventivo &&  "{{preventivo[0].data}}"  == data ){
										console.log("mm dai qualcosa");
										strToAdd = '<div class="features"> \
														<div id="tabFatturaPaginaCliente" class="table-wrapper"> \
																<table class="alt"> \
																	<thead> \
																		<tr> \
																			<th class="tdTipoLav">Lavorazione</th> \
																			<th class="tdQuantita">Quantità</th> \
																			<th class="tdUnitaMisura">Unità</th> \
																			<th class="tdTotale">Totale</th> \
																		</tr> \
																	</thead> \
																</table>';


										{% for settore in preventivo[1][0] %}
											strToAdd += '<table class="alt"> \
														<tbody> \
															<tr> \
																<td colspan="4">{{settore}}</td> \
															</tr>';

											{% for lavorazione in preventivo[1][1] %}
												{% if lavorazione[0].settore == settore %}
													strToAdd +=	'<tr> \
																	<td class="tdTipoLav">{{lavorazione[0].tipologia_lavorazione}}</td> \
																	<td class="tdQuantita">{{lavorazione[1]}}</td> \
																	<td class="tdUnitaMisura">{{lavorazione[0].unitaMisura}}</td> \
																	<td class="tdTotale">&euro; {{lavorazione[2]}}</td> \
																 </tr>';
												{% endif %}
											{% endfor %}

											strToAdd +=	'</tbody> \
														</table>';
										{% endfor %}

										strToAdd += '<div id="totalePrev"> \
																<span>Totale: </span> \
															</div> \
														</div> \
													</div>';
									}
								{% endfor %}

								$(strToAdd).insertAfter("#titlePreventivoSpan");


				}

				function impostaSelectDataPreventivoEdile(numero_preventivo){

					var firstCycle=true;

                    //resetto il select togliendo tutti i tag option
                    $('#dataSelect').html('');

					{% for preventivo in preventivi %}
						var optionElement = "";

						// di default setto come data quella piu' recente del piu' recente preventivo
						// generato per questo cliente
						if( "{{preventivo[0].numero_preventivo}}" == numero_preventivo ){
							if( firstCycle ){
								optionElement = '<option selected="selected" value="{{preventivo[0].data}}">{{preventivo[0].data}}</option>';
								firstCycle=false;
							}
							else
								optionElement = '<option value="{{preventivo[0].data}}">{{preventivo[0].data}}</option>';
						}


						$('#dataSelect').append( optionElement );


					{% endfor %}
				}

				{% if countPreventivi > 0 %}
					$('.aCtrlPreventivo').html(
							'<a id="modificaPreventivo" class="fa fa-edit expandPreventivoIcon"></a>'+
							'<a id="cancellaPreventivo" class="fa fa-trash expandPreventivoIcon"></a>'
					);

					$('#modificaPreventivo').click(function(){
					    var selPrev = $('#preventivoSelect option:selected');

						socketPreventivo.emit('modifica_preventivo', {'dip': '{{dipendente.username}}',
																	  'numero_preventivo': selPrev});
					});

					$('#cancellaPreventivo').click(function(){
						 var selPrev = $('#preventivoSelect option:selected').attr('class').split('-')[1];
						 var selData = $('#dataSelect').val();
						 socketPreventivo.emit('elimina_preventivo', {'dip': '{{dipendente.username}}',
																	  'numero_preventivo': selPrev,
																	   'data': selData });


					});

					impostaSelectDataPreventivoEdile('{{lastPreventivo[0].numero_preventivo}}');
					stampaRiassuntoPreventivo('{{lastPreventivo[0].numero_preventivo}}', '{{lastPreventivo[0].data}}');
				{% endif %}



				$('#newPreventivo').click(function(){

				    swal.withFormAsync({
						title: 'Inserire tipologia commessa:',
						showCancelButton: true,
						confirmButtonColor: '#DD6B55',
						confirmButtonText: 'Ok',
						cancelButtonText: 'annulla',
						closeOnConfirm: true,
						formFields: [

						 { name: 'commessa',  placeholder: 'tipologia commessa' },


						]
					}).then(function (context) {
						if(context._isConfirm){

							socketPreventivo.emit('registra_nuovo_preventivo',
													{ 'dip': '{{dipendente.username}}',
													  'nome_cliente' : '{{cliente.nome}}',
													  'cognome_cliente' : '{{cliente.cognome}}',
													  'indirizzo_cliente' : '{{cliente.indirizzo}}',
													  'tipologia_commessa' : context.swalForm['commessa'] }
												 );

						}
					});




				});


				/*Dopo che un preventivo e' stato cancellato viene aggiornata la pagina cliente:
					- cancellando dal select della data la data specifica
					- cancellando eventualmente dal select dei preventivi il preventivo specifico
					-impostando un nuovo preventivo di default negli appositi tag select e 'renderizzandolo'*/

				socketPreventivo.on('aggiornaAnteprimaPreventivo2', function(message){


				}

				socketPreventivo.on('aggiornaAnteprimaPreventivo', function(message){

					/* message['preventivi_restanti'] e' la quantita' di preventivi restante dopo la
					  cancellazione con ugual numero preventivo ma diversa data;
					   Quindi l'if seguente si puo' leggere: se non ci sono piu' preventi*/
					if( message['preventivi_restanti'] == 0 ){


						$('#preventivoSelect').children('option').each(function(){
							var numero=$(this).attr('class').split('-')[1];

							if(numero == message['numero_preventivo_deleted']){
								$(this).remove();

							}

						});

						/*Seleziono il prossimo preventivo di cui mostrare l'anteprima;
						  Poiche' la pagina non viene aggiornata la variabile jinja "preventivi_distinti"
						  contiene ancora il preventivo cancellato. Se il preventivo cancellato
						  e' l'ultimo preventivo fatto allora seleziona il prossimo in ordine di numero,
						  se e' un preventivo vecchio, viene selezionato l'ultimo fatto.*/

						var trovato=false;
						var num_preventivo_trovato=0;

						if(message['numero_preventivo_deleted'] == '{{lastPreventivo[0].numero_preventivo}}')
						{
							console.log("Il prev cancellato e' l'ultimo fato");
							{% for preventivo in preventivi_distinti %}
								if( !trovato && preventivo[2] != message['numero_preventivo_deleted'] ){
									trovato=true;
									num_preventivo_trovato = preventivo[2];

								}


							{% endfor %}

							/* se num_preventivo_trovato == 0 vuol dire che sono stati
								cancellati tutti i preventivi associati ad un cliente; */
							if( num_preventivo_trovato == 0 ){
								$('section#one').children('.inner').children('.features').remove();
							}
							else{

								/* reimposto il preventivoSelect in modo tale che il preventivo in anteprima
								   sia uguale a quello selezionato */
								$('#preventivoSelect').html('');
								var first = true;
								{% for prev in preventivi_distinti %}
									 if( '{{prev[2]}}' != num_preventivo_trovato ){
									 	if( first ){
									 		first=false;
									 		$('#preventivoSelect').append('<option class="numeroPreventivo-{{prev[2]}}" selected="selected">{{prev[0]}} - US{{prev[1]}}</option>');
									 	}
									 	else{
									 		$('#preventivoSelect').append('<option class="numeroPreventivo-{{prev[2]}}">{{prev[0]}} - US{{prev[1]}}</option>');
									 	}
									 }

								{% endfor %}

								impostaSelectDataPreventivoEdile(num_preventivo_trovato);
								var selectedData = $('#dataSelect').val();
								stampaRiassuntoPreventivo(num_preventivo_trovato, selectedData);

							}


						}
						else{

							console.log("Il prev cancellato non e' l'ultimo fato");
							impostaSelectDataPreventivoEdile('{{lastPreventivo[0].numero_preventivo}}');
							stampaRiassuntoPreventivo('{{lastPreventivo[0].numero_preventivo}}', '{{lastPreventivo[0].data}}');
						}



					}
					else{

					}


				});

                socketPreventivo.on('confermaRegistrazionePreventivo', function(){


                    window.location = "{{url_for('apriPreventivoEdile')}}";

                });


				$('#modificaPreventivo').click(function(){

					var selectedPreventivo = $('#preventivoSelect option:selected').attr('class').split('-')[1];
					console.log("cliccato "+ selectedPreventivo);
					socketPreventivo.emit('modifica_preventivo_edile', {'numero_preventivo': selectedPreventivo, 'dip': '{{dipendente.username}}' });
				});

				socketPreventivo.on('startModificaPreventivo', function(){
					console.log("baaaa");
					window.location = "{{url_for('apriPreventivoEdile')}}";
				});

				$('#preventivoSelect').change(function(){
					var selectedPreventivo = parseInt($('#preventivoSelect option:selected').attr('class').split('-')[1]);

					impostaSelectDataPreventivoEdile(selectedPreventivo);

					var selectedData = $('#dataSelect').val();
					stampaRiassuntoPreventivo(selectedPreventivo, selectedData);


				});

				$('#dataSelect').change(function(){
					var selectedPreventivo = parseInt($('#preventivoSelect option:selected').attr('class').split('-')[1]);
					var selectedData = $('#dataSelect').val();
					stampaRiassuntoPreventivo(selectedPreventivo, selectedData);
				});

			</script>

	</div>
	</body>
</html>